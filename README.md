# 🤖 ربات تلگرام سیگنال معاملاتی

یک ربات تلگرام پیشرفته برای مدیریت سیگنال‌های معاملاتی با امکانات زیر:

## 🌟 ویژگی‌های کلیدی

### 👥 مدیریت کاربران
- ثبت نام کاربران با اطلاعات کامل (شماره تلفن، نام، نوع دسترسی)
- پروفایل شخصی برای هر کاربر
- ردیابی فعالیت کاربران
- سطوح دسترسی مختلف (پایه، نقره‌ای، طلایی، VIP)

### 📢 مدیریت کانال
- تولید لینک‌های یکبار مصرف برای عضویت در کانال
- بررسی خودکار عضویت در کانال
- ارسال سیگنال فقط به اعضای کانال
- آمار کامل از کاربران و اعضای کانال

### 🚨 سیستم سیگنال
- ارسال سیگنال دستی از طریق پنل مدیریت
- ارسال خودکار سیگنال‌های کانال به کاربران
- ذخیره تاریخچه سیگنال‌ها در دیتابیس
- آمار ارسال سیگنال‌ها

### 🔧 پنل مدیریت
- داشبورد مدیریت برای ادمین‌ها
- مشاهده لیست کاربران
- ارسال پیام همگانی
- آمار کامل از عملکرد ربات

## 📋 پیش‌نیازها

- Python 3.8+
- حساب کاربری در تلگرام
- یک ربات تلگرام از [@BotFather](https://t.me/BotFather)
- یک کانال تلگرام برای ارسال سیگنال‌ها

## 🚀 نصب و راه‌اندازی

### 1. کلون کردن پروژه
```bash
git clone <repository-url>
cd telegram-signal-bot
```

### 2. نصب پکیج‌ها
```bash
pip install -r requirements.txt
```

### 3. تنظیمات
1. فایل `.env.example` را کپی کنید:
```bash
cp .env.example .env
```

2. فایل `.env` را ویرایش کنید:
```bash
nano .env
```

3. مقادیر زیر را تنظیم کنید:
```env
# توکن ربات از BotFather
BOT_TOKEN=YOUR_BOT_TOKEN_FROM_BOTFATHER

# آیدی کانال سیگنال (با - شروع می‌شود)
SIGNAL_CHANNEL_ID=-1001234567890

# آیدی‌های مدیران (با کاما جدا شده)
ADMIN_USER_IDS=123456789,987654321

# نام کاربری کانال (بدون @)
CHANNEL_USERNAME=your_channel_username

# سایر تنظیمات
CHANNEL_NAME=کانال سیگنال
DATABASE_PATH=bot_database.db
MAX_USERS_PER_PAGE=10
INVITE_LINK_EXPIRY_HOURS=24
```

### 4. راه‌اندازی کانال
1. کانال خود را بسازید
2. ربات را به کانال اضافه کنید
3. ربات را Admin کنید
4. آیدی کانال را در فایل `.env` قرار دهید

### 5. اجرای ربات
```bash
python telegram_bot_improved.py
```

## 🎯 نحوه استفاده

### برای کاربران عادی:
1. `/start` - شروع کار با ربات
2. ثبت نام با وارد کردن اطلاعات شخصی
3. دریافت لینک کانال
4. عضویت در کانال
5. دریافت سیگنال‌ها

### برای مدیران:
1. دسترسی به پنل مدیریت
2. مشاهده لیست کاربران
3. ارسال سیگنال دستی
4. ارسال پیام همگانی
5. مشاهده آمار کامل

## 🗂️ ساختار فایل‌ها

```
telegram-signal-bot/
├── telegram_bot.py              # نسخه ساده ربات
├── telegram_bot_improved.py     # نسخه پیشرفته ربات
├── config.py                    # تنظیمات ربات
├── requirements.txt             # پکیج‌های مورد نیاز
├── .env.example                 # نمونه فایل تنظیمات
├── README.md                    # راهنمای استفاده
└── bot_database.db             # دیتابیس ربات (خودکار ساخته می‌شود)
```

## 🗃️ ساختار دیتابیس

### جدول کاربران (users)
- `user_id`: آیدی کاربر
- `username`: نام کاربری
- `phone_number`: شماره تلفن
- `name`: نام و نام خانوادگی
- `product_access`: نوع دسترسی
- `registration_date`: تاریخ ثبت نام
- `is_active`: وضعیت فعالیت
- `channel_member`: عضویت در کانال
- `last_activity`: آخرین فعالیت

### جدول سیگنال‌ها (signals)
- `id`: شناسه سیگنال
- `signal_text`: متن سیگنال
- `signal_type`: نوع سیگنال
- `sent_date`: تاریخ ارسال
- `admin_id`: آیدی مدیر فرستنده
- `recipient_count`: تعداد دریافت کنندگان

### جدول لینک‌های دعوت (invite_links)
- `link_id`: شناسه لینک
- `user_id`: آیدی کاربر
- `created_date`: تاریخ ایجاد
- `expiry_date`: تاریخ انقضا
- `used`: وضعیت استفاده

## 🔧 تنظیمات پیشرفته

### متغیرهای محیطی
```env
# تنظیمات پایه
BOT_TOKEN=              # توکن ربات
SIGNAL_CHANNEL_ID=      # آیدی کانال
ADMIN_USER_IDS=         # آیدی مدیران

# تنظیمات کانال
CHANNEL_USERNAME=       # نام کاربری کانال
CHANNEL_NAME=           # نام کانال

# تنظیمات دیتابیس
DATABASE_PATH=          # مسیر دیتابیس

# تنظیمات عملکرد
MAX_USERS_PER_PAGE=     # حداکثر کاربر در هر صفحه
INVITE_LINK_EXPIRY_HOURS=  # مدت اعتبار لینک دعوت
```

## 📊 دستورات ربات

### دستورات عمومی:
- `/start` - شروع کار با ربات
- `/menu` - نمایش منوی اصلی
- `/cancel` - لغو عملیات جاری

### دکمه‌های تعاملی:
- **👤 پروفایل من** - مشاهده اطلاعات شخصی
- **📢 دریافت لینک کانال** - دریافت لینک عضویت
- **📊 آمار کانال** - مشاهده آمار کلی
- **🔄 بروزرسانی عضویت** - بررسی مجدد عضویت

### پنل مدیریت:
- **📤 ارسال سیگنال** - ارسال سیگنال به اعضای کانال
- **👥 لیست کاربران** - مشاهده لیست کاربران
- **📢 پیام همگانی** - ارسال پیام به همه کاربران

## 🛠️ عیب‌یابی

### مشکلات رایج:

1. **ربات پاسخ نمی‌دهد**
   - توکن ربات را بررسی کنید
   - اتصال اینترنت را بررسی کنید

2. **کانال تشخیص داده نمی‌شود**
   - آیدی کانال را بررسی کنید
   - ربات را Admin کانال کنید

3. **سیگنال‌ها ارسال نمی‌شوند**
   - وضعیت عضویت کاربران را بررسی کنید
   - لاگ‌های ربات را بررسی کنید

### نمایش لاگ‌ها:
```bash
python telegram_bot_improved.py 2>&1 | tee bot.log
```

## 🔐 امنیت

- توکن ربات را محرمانه نگه دارید
- فایل `.env` را در `.gitignore` قرار دهید
- آیدی‌های مدیران را محدود کنید
- بک‌آپ منظم از دیتابیس بگیرید

## 🆕 به‌روزرسانی

برای به‌روزرسانی ربات:
1. کد جدید را دانلود کنید
2. دیتابیس را بک‌آپ کنید
3. ربات را متوقف کنید
4. کد جدید را اعمال کنید
5. ربات را مجدداً راه‌اندازی کنید

## 📝 مجوز

این پروژه تحت مجوز MIT ارائه شده است.

## 🤝 مشارکت

برای مشارکت در پروژه:
1. پروژه را Fork کنید
2. تغییرات خود را اعمال کنید
3. Pull Request ارسال کنید

## 📞 پشتیبانی

در صورت بروز مشکل، لطفاً Issue جدید در GitHub ایجاد کنید.

---

**نوشته شده با ❤️ برای جامعه معاملات ایرانی**